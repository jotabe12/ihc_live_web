<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil de Usuario - ViviEstu</title>
    <link rel="stylesheet" href="../css/perfil_usuario.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<!-- Header -->
<header class="header">
    <div class="logo-container">
        <a href="../index.html">
            <img src="../asset/Logo.png" alt="ViviEstu Logo" class="logo" style="cursor: pointer;">
        </a>
    </div>
    <nav class="nav-menu">
        <a href="../index.html">Inicio</a>
        <a href="mapa_seguridad.html">Zonas</a>
        <a href="catalogo.html">Catálogo</a>
        <a href="foro_estudiantil.html">Comunidad</a>
        <a href="agendar_visita.html">Contacto</a>
    </nav>
    <div class="nav-buttons">
        <button class="btn-login" id="btnLoginDesktop">Iniciar Sesión</button>
        <button class="btn-register" id="btnRegisterDesktop">Registrarse</button>
    </div>
</header>

<!-- Main Content -->
<main class="main-content">
    <div class="container">
        <!-- Greeting -->
        <h1 class="greeting">Hola, <strong id="greetingName">Nombre</strong></h1>

        <!-- Profile Card -->
        <div class="profile-card">
            <div class="profile-image-container">
                <div class="profile-image">
                    <i class="fas fa-user"></i>
                </div>
            </div>
            <h2 class="profile-name" id="profileName">Nombre Completo</h2>
            <div class="profile-buttons">
                <button class="btn-profile" id="btnEditarPerfil">Editar perfil</button>
                <button class="btn-profile" onclick="alert('Funcionalidad de subir foto próximamente')">Subir foto</button>
            </div>
        </div>

        <!-- Modal para editar nombre -->
        <div id="modalEditarNombre" class="modal-editar">
            <div class="modal-editar-content">
                <span class="modal-close">&times;</span>
                <h2>Editar Nombre de Usuario</h2>
                <form id="formEditarNombre">
                    <div class="form-group">
                        <label for="nuevoNombre">Nuevo nombre:</label>
                        <input type="text" id="nuevoNombre" placeholder="Ingresa tu nuevo nombre" required>
                    </div>
                    <p id="mensajeErrorEdicion" class="mensaje-error"></p>
                    <div class="modal-buttons">
                        <button type="button" class="btn-cancelar" id="btnCancelar">Cancelar</button>
                        <button type="submit" class="btn-guardar">Guardar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Activity Sections -->
        <div class="activity-section">
            <div class="section-header">
                <h3 class="section-title">Reservas completadas</h3>
                <a href="#" class="ver-todo">ver todo</a>
            </div>
            <div class="section-content">
                <p>→ Reserva del Martes 25 de Julio</p>
            </div>
        </div>

        <div class="activity-section">
            <div class="section-header">
                <h3 class="section-title">Reseñas</h3>
                <a href="#" class="ver-todo">ver todo</a>
            </div>
            <div class="section-content">
                <p class="meta-info">1 reviews</p>
                <p>Review al arrendador Juan</p>
            </div>
        </div>

        <div class="activity-section">
            <div class="section-header">
                <h3 class="section-title">Interacciones</h3>
                <a href="#" class="ver-todo">ver todo</a>
            </div>
            <div class="section-content">
                <p class="meta-info">1 comentario</p>
                <p>Arrendador Juan - Me encantó lo amable que fue</p>
            </div>
        </div>
    </div>
</main>

<!-- Footer -->
<footer class="footer">
    <div class="footer-content">
        <div class="footer-left">
            <div class="footer-section">
                <h4>Nosotros</h4>
                <p>ViviEstu es tu plataforma confiable para encontrar el alojamiento perfecto durante tus estudios.</p>
            </div>

            <div class="footer-section">
                <h4>Centro de Ayuda</h4>
                <ul>
                    <li><a href="#">Preguntas Frecuentes</a></li>
                    <li><a href="#">Términos y Condiciones</a></li>
                    <li><a href="#">Políticas de Privacidad</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h4>Contáctanos</h4>
                <ul>
                    <li><i class="fas fa-envelope"></i> info@viviestu.com</li>
                    <li><i class="fas fa-phone"></i> +51 999 999 999</li>
                    <li><i class="fas fa-map-marker-alt"></i> Lima, Perú</li>
                </ul>
            </div>
        </div>

        <div class="footer-right">
            <h2 class="footer-brand">ViviEstu</h2>
            <p class="footer-tagline">Tu hogar mientras estudias</p>
            <div class="social-links">
                <a href="#" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
                <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
            </div>
        </div>
    </div>

    <div class="footer-bottom">
        <p>&copy; 2025 ViviEstu. Todos los derechos reservados.</p>
    </div>
</footer>

<script src="../js/app.js"></script>
<script>
// Proteger página - solo accesible con sesión
SessionManager.protectPage();

// Cargar datos del usuario
document.addEventListener('DOMContentLoaded', function() {
    const user = SessionManager.getUser();

    if (user) {
        // Actualizar nombre en el saludo y perfil
        document.getElementById('greetingName').textContent = user.nombre;
        document.getElementById('profileName').textContent = user.nombre;
    }

    // ==========================================
    // MODAL EDITAR NOMBRE
    // ==========================================
    const modal = document.getElementById('modalEditarNombre');
    const btnEditar = document.getElementById('btnEditarPerfil');
    const btnCerrar = document.querySelector('.modal-close');
    const btnCancelar = document.getElementById('btnCancelar');
    const formEditar = document.getElementById('formEditarNombre');
    const inputNuevoNombre = document.getElementById('nuevoNombre');
    const mensajeError = document.getElementById('mensajeErrorEdicion');

    // Abrir modal
    btnEditar.addEventListener('click', function() {
        if (user) {
            inputNuevoNombre.value = user.nombre; // Pre-llenar con el nombre actual
            mensajeError.textContent = '';
            mensajeError.style.display = 'none';
            modal.style.display = 'block';
        }
    });

    // Cerrar modal con X
    btnCerrar.addEventListener('click', function() {
        modal.style.display = 'none';
    });

    // Cerrar modal con botón Cancelar
    btnCancelar.addEventListener('click', function() {
        modal.style.display = 'none';
    });

    // Cerrar modal al hacer clic fuera de él
    window.addEventListener('click', function(event) {
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    });

    // Manejar envío del formulario
    formEditar.addEventListener('submit', function(e) {
        e.preventDefault();

        const nuevoNombre = inputNuevoNombre.value.trim();

        // Validar que el nombre no esté vacío
        if (!nuevoNombre) {
            mensajeError.textContent = 'El nombre no puede estar vacío';
            mensajeError.style.display = 'block';
            return;
        }

        // Validar longitud mínima
        if (nuevoNombre.length < 2) {
            mensajeError.textContent = 'El nombre debe tener al menos 2 caracteres';
            mensajeError.style.display = 'block';
            return;
        }

        // Actualizar el nombre del usuario
        const actualizado = SessionManager.updateUserName(nuevoNombre);

        if (actualizado) {
            // Actualizar la interfaz
            document.getElementById('greetingName').textContent = nuevoNombre;
            document.getElementById('profileName').textContent = nuevoNombre;

            // Actualizar el header (nombre en dropdown)
            HeaderManager.updateHeader();

            // Cerrar modal
            modal.style.display = 'none';

            // Mostrar mensaje de éxito
            alert('¡Nombre actualizado exitosamente!');
        } else {
            mensajeError.textContent = 'Error al actualizar el nombre';
            mensajeError.style.display = 'block';
        }
    });
});
</script>
</body>
</html>

